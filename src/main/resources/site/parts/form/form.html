<form method="POST" action="" data-th-action="${postUrl}" id="recaptchaForm">
    <div>
        <label>
            <span>Name:</span>
            <input type="text" name="name"/>
        </label>
        <br/><br/>
        <div data-th-if="${recaptchaIsConfigured and !editMode}" class="g-recaptcha" data-th-attr="data-sitekey=${recaptchaSiteKey}" data-sitekey="124" data-callback="recaptchaCallback"></div>
        <div data-th-if="${!recaptchaIsConfigured}">Please configure reCAPTCHA</div>
        <br/>
        <input type="submit" value="Submit" id="submit-button"/>
    </div>
</form>

<div id="formResult" style="display: none;"></div>

<script>
    function recaptchaCallback() {
        var submitBtn = document.getElementById('submit-button');
        submitBtn.removeAttribute('disabled');
    };

    $(function() {
        $('#recaptchaForm').submit(function(e) {
            var postData = $(this).serializeArray();
            var formURL = $(this).attr("action");

            // Simple ajax submit with check if recaptcha verified ok or not
            $.ajax({
                type: "POST",
                url: formURL,
                data: postData,
                success: function(data) {
                    $('#recaptchaForm').hide();
                    var result;
                    if (data.recaptchaVerified) {
                        result = 'Woohooo, it worked :)';
                    }
                    else {
                        result = 'Oh no, try again :(';
                    }
                    $('#formResult').text(result).show();
                },
                dataType: 'json'
            });

            e.preventDefault();
        });
    });
</script>